#include <gtest/gtest.h>  
#include <cstdio>

#include "AESState.hpp"

TEST(AESState_Tests, xTimesTests) {
    unsigned char value = 0x57;
    unsigned char test_values[9] = {0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x13};
    unsigned char exp_res[9] = {0x57, 0xae, 0x47, 0x8e, 0x07, 0x0e, 0x1c,0x38, 0xfe};
    unsigned char result;
    for (int i = 0; i < 9; i++){
        result = AESState::xTimes(value, test_values[i]);
        printf("xTimes(%.2x, %.2x) = %.2x (exp = %.2x)\n", value, test_values[i], result, exp_res[i]);
        EXPECT_EQ(result, exp_res[i]);
    }
}

TEST(AESState_Tests, mixColumnsTest){
    unsigned char mix_col_example[16] = {0xf2, 0x01, 0xc6, 0xdb, 0x0a, 0x01, 0xc6, 0x13, 0x22, 0x01, 0xc6, 0x53, 0x5c, 0x01, 0xc6, 0x45};
    unsigned char exp_mix[16] = {0x9f, 0x01, 0xc6, 0x8e, 0xdc, 0x01, 0xc6, 0x4d, 0x58, 0x01, 0xc6, 0xa1, 0x9d, 0x01, 0xc6, 0xbc};
    AESState s = AESState{mix_col_example};
    printf("\nMix Columns Example Matrix\n");
    s.printState();
    s.mixColumns();
    printf("Mixed Columns\n");
    s.printState();
    AESState s_expected = AESState(exp_mix);
    EXPECT_EQ(s, s_expected);
}

TEST(AESState_Tests, inverseMixColumnsTest){
    unsigned char mix_col_example[16] = {0xf2, 0x01, 0xc6, 0xdb, 0x0a, 0x01, 0xc6, 0x13, 0x22, 0x01, 0xc6, 0x53, 0x5c, 0x01, 0xc6, 0x45};
    unsigned char exp_mix[16] = {0x9f, 0x01, 0xc6, 0x8e, 0xdc, 0x01, 0xc6, 0x4d, 0x58, 0x01, 0xc6, 0xa1, 0x9d, 0x01, 0xc6, 0xbc};
    AESState s = AESState{exp_mix};
    printf("Mixed Columns\n");
    s.printState();
    printf("Inverse Mixed Columns\n");
    s.invMixColumns();
    s.printState();
    AESState s_expected = AESState(mix_col_example);
    EXPECT_EQ(s, s_expected);
}

TEST(AESState_Tests, subBytesTest){
    unsigned char sub_example[16] = {0x53, 0x01, 0xc6, 0xdb, 0x0a, 0x01, 0xc6, 0x13, 0x22, 0x01, 0xc6, 0x53, 0x5c, 0x01, 0xc6, 0x45,};
    unsigned char exp_sub[16] = {0xed, 0x7c, 0xb4, 0xb9, 0x67, 0x7c, 0xb4, 0x7d, 0x93, 0x7c, 0xb4, 0xed, 0x4a, 0x7c, 0xb4, 0x6e,};
    AESState s = AESState{sub_example};
    printf("\nSub Bytes Example Matrix\n");
    s.printState();
    s.subBytes();
    printf("Substituted Bytes\n");
    s.printState();
    AESState s_expected = AESState(exp_sub);
    EXPECT_EQ(s, s_expected);
}

TEST(AESState_Tests, inverseSubBytesTest){
    unsigned char sub_example[16] = {0x53, 0x01, 0xc6, 0xdb, 0x0a, 0x01, 0xc6, 0x13, 0x22, 0x01, 0xc6, 0x53, 0x5c, 0x01, 0xc6, 0x45,};
    unsigned char exp_sub[16] = {0xed, 0x7c, 0xb4, 0xb9, 0x67, 0x7c, 0xb4, 0x7d, 0x93, 0x7c, 0xb4, 0xed, 0x4a, 0x7c, 0xb4, 0x6e,};
    AESState s = AESState{exp_sub};
    printf("Substituted Bytes\n");
    s.printState();
    printf("Inverse Substituted Bytes\n");
    s.invSubBytes();
    s.printState();
    AESState s_expected = AESState(sub_example);
    EXPECT_EQ(s, s_expected);
}

TEST(AESState_Tests, shiftRowsTest){
    unsigned char shift_example[16] = {0xed, 0x7c, 0xb4, 0xb9, 0x67, 0x7c, 0xb4, 0x7d, 0x93, 0x7c, 0xb4, 0xed, 0x4a, 0x7c, 0xb4, 0x6e,};
    unsigned char exp_shift[16] = {0xed, 0x7c, 0xb4, 0xb9, 0x7c, 0xb4, 0x7d, 0x67, 0xb4, 0xed, 0x93, 0x7c, 0x6e, 0x4a, 0x7c, 0xb4};
    AESState s = AESState{shift_example};
    printf("\nShift Rows Example Matrix\n");
    s.printState();
    s.shiftRows();
    printf("Shifted Rows\n");
    s.printState();
    AESState s_expected = AESState(exp_shift);
    EXPECT_EQ(s, s_expected);
}

TEST(AESState_Tests, inverseShiftRowsTest){
    unsigned char shift_example[16] = {0xed, 0x7c, 0xb4, 0xb9, 0x67, 0x7c, 0xb4, 0x7d, 0x93, 0x7c, 0xb4, 0xed, 0x4a, 0x7c, 0xb4, 0x6e,};
    unsigned char exp_shift[16] = {0xed, 0x7c, 0xb4, 0xb9, 0x7c, 0xb4, 0x7d, 0x67, 0xb4, 0xed, 0x93, 0x7c, 0x6e, 0x4a, 0x7c, 0xb4};
    AESState s = AESState{exp_shift};
    printf("Shifted Rows\n");
    s.printState();
    s.invShiftRows();
    printf("Inverse Shifted Rows\n");
    s.printState();
    AESState s_expected = AESState(shift_example);
    EXPECT_EQ(s, s_expected);
}